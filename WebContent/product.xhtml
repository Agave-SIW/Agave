<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [
    <!ENTITY nbsp "&#160;"> 
    <!ENTITY copy "&#169;">
    <!ENTITY euro "&#8364;"> 
]>
<ui:composition template="/WEB-INF/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="title">
		<h:outputText
			value="#{productController.getProductFromId(param['id']).name}" /> | Agave Shop - SIW 2015
    </ui:define>

	<ui:define name="content">
		<c:set var="root" value="#{request.contextPath}" />

		<div class="row">
			<h:panelGroup rendered="#{not empty productController.product}">
				<div class="col-md-12">

					<div class="thumbnail">
						<img class="img-responsive"
							src="#{root}/uploads/#{productController.product.picturePath}"
							alt="#{productController.product.name}" />

						<div class="caption-full">
							<h4 class="pull-right price">
								<h:outputText value="#{productController.product.price}">
									<f:convertNumber pattern="#0.00 &#8364;" />
								</h:outputText>
							</h4>
							<h2>#{productController.product.name}</h2>


							<div class="col-md-6 pull-right" id="buyFrameDiv">
								<iframe id="buyFrame"
									src="#{root}/addToCart.xhtml?id=#{productController.product.id}"
									width="100%" height="55" seamless="seamless"
									style="display: none"></iframe>
							</div>


							<div style="padding-left: 5px;">
								<span class="glyphicon glyphicon-barcode"></span> <strong>Product code:  </strong>
								#{productController.product.code}
							</div>
							<div style="padding-left: 5px;">
								<span class="glyphicon glyphicon-th-large"></span> <strong>Storage
								quantity:  </strong><span id="productQuantity">#{productController.product.storageQuantity}</span>
							</div>
							<c:set var="providers" value="#{productController.findProviders(param['id'])}" />
							<h:panelGroup rendered="#{not empty providers}">
							<div style="padding-left: 5px;">
								<span class="glyphicon glyphicon-transfer"></span> <strong>Provided by: </strong>
								<c:forEach var="provider"
									items="#{providers}" varStatus="loop">
							<a href="mailto:#{provider.email}" data-toggle="tooltip" data-placement="bottom" title="Address:&#8239;#{provider.address} Vatin:&#8239;#{provider.vatin} Phone:&#8239;#{provider.phoneNumber}">#{provider.name}</a><c:if test="${!loop.last}">,</c:if> 
							</c:forEach>
							</div>
							</h:panelGroup>
							<hr />
							<p>#{productController.product.description}</p>
						</div>

						<div class="ratings">
							<p class="pull-right">#{productController.getReviewNumber()}</p>
							<p>
								<h:outputText
									value="#{productController.getReviewAverageHtml()}"
									escape="false" />
								<h:outputText value="#{productController.getReviewAverage()}">
									<f:convertNumber pattern="#0.0" />
								</h:outputText>
								stars
							</p>
						</div>
					</div>
					<div class="well">
						<div class="col-md-12" id="reviewFrameDiv" style="display: none">
							<iframe id="reviewFrame"
								src="#{root}/newReview.xhtml?id=#{productController.product.id}"
								width="100%" height="100" seamless="seamless"></iframe>
						</div>
						<h:panelGroup rendered="#{customerController.isLogged()}">
							<div class="text-right">
								<a class="btn btn-success" id="addReviewButton">Add a review</a>
							</div>
						</h:panelGroup>
						<h:panelGroup rendered="#{customerController.isNotLogged()}">
							<div class="text-right">You must be logged to send a
								review.</div>
						</h:panelGroup>
						<div class="reviewHr">
							<hr />
						</div>
						<ui:repeat var="review" value="#{productController.getReviews()}">
							<div class="row review">
								<div class="col-md-12">
									<h:outputText
										value="#{productController.getReviewHtml(review)}"
										escape="false" />
									#{review.getCustomerName()} <span class="pull-right"><h:outputText
											value="#{review.getDate()}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText></span>
									<p>#{review.getComment()}</p>
								</div>
							</div>

							<div class="reviewHr">
								<hr />
							</div>
						</ui:repeat>

					</div>

				</div>
			</h:panelGroup>
			<h:panelGroup rendered='#{empty productController.product}'>

				<div class="col-lg-12">

					<div class="col-md-12">
						<h1>Ops</h1>
						<hr />
						<span class="label label-warning">There is no product with
							the selected id</span> Loading previous page...
						<script type="text/javascript">
							if(document.referrer) {
							window.location = document.referrer + 
							((document.referrer.indexOf('?')!=-1 &amp;&amp; 
									document.referrer.indexOf('rel=')!=-1)? 
											"&amp;rel=1":"");
							}
							else {
								window.history.back();
							}
						</script>
					</div>
				</div>
			</h:panelGroup>

		</div>

	</ui:define>

</ui:composition>
