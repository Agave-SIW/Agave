<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html [
    <!ENTITY nbsp "&#160;"> 
    <!ENTITY copy "&#169;">
    <!ENTITY euro "&#8364;"> 
]>
<ui:composition template="/WEB-INF/template.xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<f:metadata>
		<f:event type="preRenderView"
			listener="#{productController.setProductFromId}">
			<f:param name="id" value="#{productController.id}" />
		</f:event>
	</f:metadata>

	<ui:define name="title">
        ${productController.product.name} | Agave Shop - SIW 2015
    </ui:define>

	<ui:define name="content">

		<div class="row">
			<h:panelGroup rendered='#{not empty productController.product}'>
				<div class="col-md-12">

					<div class="thumbnail">
						<img class="img-responsive" src="http://placehold.it/1150x400"
							alt="" />

						<div class="caption-full">
							<h4 class="pull-right price">
								<h:outputText value="#{productController.product.price}">
									<f:convertNumber pattern="#0.00 &#8364;" />
								</h:outputText>
							</h4>
							<h2>${productController.product.name}</h2>
							<div>Code: ${productController.product.code}</div>
							<div>${productController.product.description}</div>
						</div>

						<div class="ratings">
							<p class="pull-right">${productController.getReviewNumber()}</p>
							<p>
								<h:outputText
									value="#{productController.getReviewAverageHtml()}"
									escape="false" />
								${productController.getReviewAverage()} stars
							</p>
						</div>
					</div>

					<div class="well">

						<h:form>
							<h:inputTextarea value="#{productController.comment}"
								required="false" cols="20" rows="3" id="comment"
								styleClass="form-control" />

							<h:inputText value="#{productController.stars}" required="true"
								requiredMessage="Vote is mandatory" id="stars"
								styleClass="form-control needRequired needPlaceholder" />

							<div class="text-right">
								<h:inputHidden value="#{view.viewId}" id="page" />
								<h:commandButton value="Leave a Review" immediate="true"
									action='#{productController.addReview(sessionScope["customer"].id, product.id)}'
									styleClass="btn btn-success" />
							</div>

						</h:form>

						<hr />

						<ui:repeat var="review" value="#{productController.getReviews()}">
							<div class="row">
								<div class="col-md-12">
									<h:outputText
										value="#{productController.getReviewHtml(review)}"
										escape="false" />
									#{review.getCustomerName()} <span class="pull-right">#{review.getDate()}</span>
									<p>#{review.getComment()}</p>
								</div>
							</div>

							<hr />
						</ui:repeat>

					</div>

				</div>
			</h:panelGroup>
			<h:panelGroup rendered='#{empty productController.product}'>

				<div class="col-lg-12">

					<div class="col-md-12">
						<h1>Error</h1>
						<hr />
						<span class="label label-warning">There is no product with
							the selected id</span>
					</div>
				</div>
			</h:panelGroup>
		</div>

	</ui:define>
</ui:composition>
